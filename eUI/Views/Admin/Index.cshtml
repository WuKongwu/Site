@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Scripts.Render(eUI.Common.JsFiles.AdminInput)
@Scripts.Render(eUI.Common.JsFiles.UserGridEditingInline)
<script src="~/Js/ajaxfileupload.js"></script>
<script src="~/Style/jquery.uploadify-v2.1.4/jquery.uploadify.v2.1.4.js" type="text/javascript"></script>
<script src="~/Style/jquery.uploadify-v2.1.4/swfobject.js" type="text/javascript"></script>
<script src="~/Style/jquery.uploadify-v2.1.4/jquery.uploadify.v2.1.4.min.js" type="text/javascript"></script>
<link href="~/Style/jquery.uploadify-v2.1.4/uploadify.css" rel="stylesheet" type="text/css" />
@*<link href="~/Style/kindeditor-4.1.7/themes/default/default.css" rel="stylesheet" />*@

<script type="text/javascript">

    function initPop() {
        $('[name="txtAddTitle"]').val(''),
        $('[name="txtAddTitle"]').prev().val('');
        $('[name="txtAddShow"]').val(''),
        $('[name="txtAddPrice"]').val(''),
          $('[name="txtAddShow"]').prev().val('');
        $('[name="txtAddPrice"]').prev().val('');
        $("#txtAddType").val(0),
         $("#textarea_id").val("");
        $("#Id").val(0);
        $(".file-name").html("");
        $("input[type='file']").val("");
        $('#dlg').window('open');
        $("#t_guid").text("");
    }
    function Add() {
        initPop();
        $('#dlg').window('open');

    }
    $(function () {
        function CheckFileType(file, type) {
            var reg = /[^\\\/]*[\\\/]+/g; //匹配文件的名称和后缀的正则表达式
            var name = $(file).val().replace(reg, '');
            var postfix = /\.[^\.]+/.exec(name);//获取文件的后缀
            postfix = postfix + "";
            postfix = postfix.toLowerCase();
            if (type == "img") {
                if (postfix == ".jpeg") {
                    return true;
                } else if (postfix == ".png") {
                    return true;
                }
                else if (postfix == ".jpg") {
                    return true;
                }
                else if (postfix == ".bmp") {
                    return true;
                } else if (postfix == ".gif") {
                    return true;
                } else {
                    return false;
                }
            } else if (type == "video") {
                if (postfix == ".mp4") {
                    return true;
                } else if (postfix == ".ogg") {
                    return true;
                } else if (postfix == ".webm") {
                    return true;
                } else {
                    return false;
                }
            } else {
                if (postfix == ".zip") {
                    return true;
                } else if (postfix == ".rar") {
                    return true;
                } else {
                    return false;
                }
            }
            return false;
        }

        $("#uploadImg1").click(function () {
            if ($("#file1").val().length > 0) {
                var size = $("#file1")[0].files[0].size;
                if (CheckFileType($("#file1"), "img")) {
                    if (size > 5242880) { alert("图片大小不能超过5M！"); } else { var img = ajaxFileUpload("file1"); }

                } else {
                    alert("图片格式支持jpeg、jpg、png、bmp、gif");
                }

            }
            else {
                alert("请选择图片");
            }
        });
        $("#uploadImg2").click(function () {
            if ($("#file2").val().length > 0) {
                var size = $("#file2")[0].files[0].size;
                if (CheckFileType($("#file2"), "img")) {
                    if (size > 5242880) { alert("图片大小不能超过5M！"); } else { var img = ajaxFileUpload("file2"); }
                } else {
                    alert("图片格式支持jpeg、jpg、png、bmp、gif");
                }
            }
            else {
                alert("请选择图片");
            }
        });
        $("#uploadImg3").click(function () {
            if ($("#file3").val().length > 0) {
                var size = $("#file3")[0].files[0].size;
                if (CheckFileType($("#file3"), "img")) {
                    if (size > 5242880) { alert("图片大小不能超过5M！"); } else { var img = ajaxFileUpload("file3"); }
                } else {
                    alert("图片格式支持jpeg、jpg、png、bmp、gif");
                }
            }
            else {
                alert("请选择图片");
            }
        });



        $("#uploadVideo").click(function () {
            if ($("#Vfile").val().length > 0) {
                var size = $("#Vfile")[0].files[0].size;
                if (CheckFileType($("#Vfile"), "video")) {
                   
                    if (size > 104857600) { alert("视频大小不能超过100M！"); } else { var img = ajaxFileUpload("Vfile"); }
                } else {
                    alert("视频格式支持mp4、webm、ogg");
                }
            }
            else {
                alert("请选择视频");
            }
        });
        $("#uploadCode").click(function () {
            if ($("#Cfile").val().length > 0) {
                var size = $("#Cfile")[0].files[0].size;
                if (CheckFileType($("#Cfile"), "file")) {
                    if (size > 104857600) { alert("文件大小不能超过100M！"); } else { var img = ajaxFileUpload("Cfile"); }
                } else {
                    alert("代码附件格式支持zip、rar");
                }
            }
            else {
                alert("请选择代码附件");
            }
        });

    });

    function ajaxFileUpload(val) {
        var guid = $("#t_guid").text();
        $.ajaxFileUpload
        (
            {
                url: '/Admin/Uploadfile', //用于文件上传的服务器端请求地址
                type: 'post',
                data: { guid: guid }, //此参数非常严谨，写错一个引号都不行
                secureuri: false, //一般设置为false
                fileElementId: [val], //文件上传空间的id属性  <input type="file" id="file" name="file" />
                dataType: 'HTML', //返回值类型 一般设置为json
                success: function (data, status)  //服务器成功响应处理函数
                {
                    var ext = JSON.parse(data)

                    $("#t_" + val).text(ext.imgPath1);
                    $("#t_guid").text(ext.guid);
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            }
        )

    }
    $(function () {
        $('#dlg').window('close');
        $('#submit').click(function (e) {
            debugger
            var param = {
                Id: $("#Id").val(),
                Title: $('[name="txtAddTitle"]').val(),
                Info: $('[name="txtAddShow"]').val(),
                Price: $('[name="txtAddPrice"]').val(),
                Type: $("#txtAddType").val(),
                DetailInfo: $("#textarea_id").val(),
                ImgA: $("#t_file1").html(),
                ImgB: $("#t_file2").html(),
                ImgC: $("#t_file3").html(),
                Video: $("#t_Vfile").html(),
                FileUrl: $("#t_Cfile").text(),
                Code: $("#t_guid").text()
            };
            $.ajax({
                url: "../Admin/Save",
                type: 'POST',
                data: param,
                success: function (data) {
                    if (data.success) {
                        $("#papergrid").datagrid('reload');
                        $('#dlg').window('close');
                    }
                }
            });
        });

    });
</script>
<div style="font-size: 12px;padding: 10px 0;">
    <div>
        查询条件：<div style="padding: 5px;border: 1px solid #95B8E7;margin: 5px 0;">
            论文编号：<input class="textbox-value easyui-textbox" id="txtSearchOrderNumber" type="text" />
            论文标题：<input class="textbox-value easyui-textbox" id="txtSearchTitle" type="text" /><br /><br />
            <div>
                交易起止时间：<input id="txtSearchPayDateStart" type="date" class="easyui-textbox" />——<input id="txtSearchPayDateEnd" class="easyui-textbox" type="date" />
            </div>
        </div>
        <button id="btnSearch" class="easyui-linkbutton" style="width:80px;">查询</button>
        <button id="btnAdd" class="easyui-linkbutton" style="width:80px;" onclick="Add()">添加</button>
    </div>
</div>
<div id="papergrid"></div>
<div id="dlg" class="easyui-window" title="论文编辑" data-options="iconCls:'icon-save'" style="width:700px;height:500px;padding:10px;position: relative;">
    <div><input type="hidden" id="Id" /></div>
    <div>
        论文标题：<input class="textbox-value upload-input" id="txtAddTitle" name="txtAddTitle" type="text" />
        论文简介：<input class="textbox-value upload-input" id="txtAddShow" name="txtAddShow" type="text" />
    </div><br />
    <div>
        论文价格：<input class="textbox-value upload-input" name="txtAddPrice" id="txtAddPrice" type="number" />
        论文类别：<select name="Type" class="selected" id="txtAddType">
            <option value="0">----</option>
            <option value="1">asp作品</option>
            <option value="2">jsp/java作品</option>
            <option value="3">asp.net/c#作品</option>
            <option value="4">php作品</option>
            <option value="5">vc++作品</option>
            <option value="6">安卓作品</option>
            <option value="7">ios作品</option>
            <option value="8">游戏作品</option>
        </select>
    </div>
    <div>
        <table class="upload-table">
            <thead>
                <tr>
                    <th width="35%">附件选择</th>
                    <th width="15%">点击上传</th>
                    <th width="50%">文件名称</th>
                </tr>
            </thead>
            <tr>
                <td><input type="file" id="Cfile" name="Cfile" /></td>
                <td><button type="button" name="submitName" class="easyui-linkbutton l-btn l-btn-small" id="uploadCode" style="width:75px">上传论文</button></td>
                <td><span id="t_Cfile" class="file-name"></span><input type="hidden" id="t_guid" /></td>

            </tr>
            <tr>
                <td><input type="file" id="Vfile" name="Vfile" /></td>
                <td><button type="button" name="submitName" class="easyui-linkbutton l-btn l-btn-small" id="uploadVideo" style="width:75px">上传视频</button></td>
                <td><span id="t_Vfile" class="file-name"></span></td>
            </tr>
            <tr>
                <td><input type="file" id="file1" name="file1" /></td>
                <td><button type="button" name="submitName" class="easyui-linkbutton l-btn l-btn-small" id="uploadImg1" style="width:75px">上传图片</button></td>
                <td><span id="t_file1" class="file-name"></span></td>
            </tr>
            <tr>
                <td><input type="file" id="file2" name="file2" /></td>
                <td><button type="button" name="submitName" class="easyui-linkbutton l-btn l-btn-small" id="uploadImg2" style="width:75px">上传图片</button></td>
                <td><span id="t_file2" class="file-name"></span></td>
            </tr>
            <tr>
                <td><input type="file" id="file3" name="file3" /></td>
                <td><button type="button" name="submitName" class="easyui-linkbutton l-btn l-btn-small" id="uploadImg3" style="width:75px">上传图片</button></td>
                <td><span id="t_file3" class="file-name"></span></td>
            </tr>
        </table>
    </div>
    <div>
        <textarea id="textarea_id" name="content" class="upload-textarea"></textarea>
    </div>
    <div><button type="button" name="submitName" class="upload-button" id="submit">提交</button></div>

</div>